<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="EraVM instruction tracer."><title>Tracer in zksync_vm2_interface - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-970bf1bf55bd1c15.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="zksync_vm2_interface" data-themes="" data-resource-suffix="" data-rustdoc-version="1.82.0-nightly (28a58f2fa 2024-07-31)" data-channel="nightly" data-search-js="search-ef54e092fea9c776.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../static.files/storage-118b08c4c78b968e.js"></script><script defer src="sidebar-items.js"></script><script defer src="../static.files/main-f9142fe437216fc3.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-df360f571f6edeae.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../zksync_vm2_interface/index.html">zksync_<wbr>vm2_<wbr>interface</a><span class="version">0.4.0</span></h2></div><h2 class="location"><a href="#">Tracer</a></h2><div class="sidebar-elems"><section><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.after_instruction">after_instruction</a></li><li><a href="#method.before_instruction">before_instruction</a></li><li><a href="#method.on_extra_prover_cycles">on_extra_prover_cycles</a></li></ul><h3><a href="#foreign-impls">Implementations on Foreign Types</a></h3><ul class="block"><li><a href="#impl-Tracer-for-()">()</a></li><li><a href="#impl-Tracer-for-(A,+B)">(A, B)</a></li></ul><h3><a href="#object-safety">Object Safety</a></h3><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In crate zksync_<wbr>vm2_<wbr>interface</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><rustdoc-search></rustdoc-search><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="index.html">zksync_vm2_interface</a>::<wbr><a class="trait" href="#">Tracer</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../src/zksync_vm2_interface/tracer_interface.rs.html#256-283">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait Tracer {
    // Provided methods
    fn <a href="#method.before_instruction" class="fn">before_instruction</a>&lt;OP: <a class="trait" href="trait.OpcodeType.html" title="trait zksync_vm2_interface::OpcodeType">OpcodeType</a>, S: <a class="trait" href="trait.GlobalStateInterface.html" title="trait zksync_vm2_interface::GlobalStateInterface">GlobalStateInterface</a>&gt;(
        &amp;mut self,
        state: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut S</a>,
    ) { ... }
<span class="item-spacer"></span>    fn <a href="#method.after_instruction" class="fn">after_instruction</a>&lt;OP: <a class="trait" href="trait.OpcodeType.html" title="trait zksync_vm2_interface::OpcodeType">OpcodeType</a>, S: <a class="trait" href="trait.GlobalStateInterface.html" title="trait zksync_vm2_interface::GlobalStateInterface">GlobalStateInterface</a>&gt;(
        &amp;mut self,
        state: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut S</a>,
    ) -&gt; <a class="enum" href="enum.ShouldStop.html" title="enum zksync_vm2_interface::ShouldStop">ShouldStop</a> { ... }
<span class="item-spacer"></span>    fn <a href="#method.on_extra_prover_cycles" class="fn">on_extra_prover_cycles</a>(&amp;mut self, _stats: <a class="enum" href="enum.CycleStats.html" title="enum zksync_vm2_interface::CycleStats">CycleStats</a>) { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>EraVM instruction tracer.</p>
<p><a href="trait.Tracer.html#method.before_instruction"><code>Self::before_instruction()</code></a> is called just before the actual instruction is executed.
If the instruction is skipped, <code>before_instruction</code> will be called with <a href="opcodes/struct.Nop.html" title="struct zksync_vm2_interface::opcodes::Nop"><code>Nop</code></a>.
<a href="trait.Tracer.html#method.after_instruction"><code>Self::after_instruction()</code></a> is called once the instruction is executed and the program
counter has advanced.</p>
<h2 id="examples"><a class="doc-anchor" href="#examples">§</a>Examples</h2>
<p>Here <code>FarCallCounter</code> counts the number of far calls.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">struct </span>FarCallCounter(usize);

<span class="kw">impl </span>Tracer <span class="kw">for </span>FarCallCounter {
    <span class="kw">fn </span>before_instruction&lt;OP: OpcodeType, S: GlobalStateInterface&gt;(<span class="kw-2">&amp;mut </span><span class="self">self</span>, state: <span class="kw-2">&amp;mut </span>S) {
        <span class="kw">match </span>OP::VALUE {
            Opcode::FarCall(<span class="kw">_</span>) =&gt; <span class="self">self</span>.<span class="number">0 </span>+= <span class="number">1</span>,
            <span class="kw">_ </span>=&gt; {}
        }
    }
}</code></pre></div>
</div></details><h2 id="provided-methods" class="section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.before_instruction" class="method"><a class="src rightside" href="../src/zksync_vm2_interface/tracer_interface.rs.html#260-262">source</a><h4 class="code-header">fn <a href="#method.before_instruction" class="fn">before_instruction</a>&lt;OP: <a class="trait" href="trait.OpcodeType.html" title="trait zksync_vm2_interface::OpcodeType">OpcodeType</a>, S: <a class="trait" href="trait.GlobalStateInterface.html" title="trait zksync_vm2_interface::GlobalStateInterface">GlobalStateInterface</a>&gt;(
    &amp;mut self,
    state: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut S</a>,
)</h4></section></summary><div class="docblock"><p>This method is executed before an instruction handler.</p>
<p>The default implementation does nothing.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.after_instruction" class="method"><a class="src rightside" href="../src/zksync_vm2_interface/tracer_interface.rs.html#271-277">source</a><h4 class="code-header">fn <a href="#method.after_instruction" class="fn">after_instruction</a>&lt;OP: <a class="trait" href="trait.OpcodeType.html" title="trait zksync_vm2_interface::OpcodeType">OpcodeType</a>, S: <a class="trait" href="trait.GlobalStateInterface.html" title="trait zksync_vm2_interface::GlobalStateInterface">GlobalStateInterface</a>&gt;(
    &amp;mut self,
    state: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut S</a>,
) -&gt; <a class="enum" href="enum.ShouldStop.html" title="enum zksync_vm2_interface::ShouldStop">ShouldStop</a></h4></section></summary><div class="docblock"><p>This method is executed after an instruction handler.</p>
<p>The return value indicates whether the VM should continue or stop execution.
The tracer’s return value takes precedence over the VM but only if it is at least as severe.
For example, if the VM wants to stop and the tracer wants to suspend, the VM will still stop.</p>
<p>The default implementation does nothing.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.on_extra_prover_cycles" class="method"><a class="src rightside" href="../src/zksync_vm2_interface/tracer_interface.rs.html#282">source</a><h4 class="code-header">fn <a href="#method.on_extra_prover_cycles" class="fn">on_extra_prover_cycles</a>(&amp;mut self, _stats: <a class="enum" href="enum.CycleStats.html" title="enum zksync_vm2_interface::CycleStats">CycleStats</a>)</h4></section></summary><div class="docblock"><p>Provides cycle statistics for “complex” instructions from the prover perspective (mostly precompile calls).</p>
<p>The default implementation does nothing.</p>
</div></details></div><h2 id="object-safety" class="section-header">Object Safety<a href="#object-safety" class="anchor">§</a></h2><div class="object-safety-info">This trait is <b>not</b> <a href="https://doc.rust-lang.org/nightly/reference/items/traits.html#object-safety">object safe</a>.</div><h2 id="foreign-impls" class="section-header">Implementations on Foreign Types<a href="#foreign-impls" class="anchor">§</a></h2><section id="impl-Tracer-for-()" class="impl"><a class="src rightside" href="../src/zksync_vm2_interface/tracer_interface.rs.html#333">source</a><a href="#impl-Tracer-for-()" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Tracer.html" title="trait zksync_vm2_interface::Tracer">Tracer</a> for <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a></h3></section><div class="docblock"><p>No-op tracer implementation.</p>
</div><details class="toggle implementors-toggle"><summary><section id="impl-Tracer-for-(A,+B)" class="impl"><a class="src rightside" href="../src/zksync_vm2_interface/tracer_interface.rs.html#336-355">source</a><a href="#impl-Tracer-for-(A,+B)" class="anchor">§</a><h3 class="code-header">impl&lt;A: <a class="trait" href="trait.Tracer.html" title="trait zksync_vm2_interface::Tracer">Tracer</a>, B: <a class="trait" href="trait.Tracer.html" title="trait zksync_vm2_interface::Tracer">Tracer</a>&gt; <a class="trait" href="trait.Tracer.html" title="trait zksync_vm2_interface::Tracer">Tracer</a> for <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.tuple.html">(A, B)</a></h3></section></summary><div class="impl-items"><section id="method.before_instruction-1" class="method trait-impl"><a class="src rightside" href="../src/zksync_vm2_interface/tracer_interface.rs.html#337-340">source</a><a href="#method.before_instruction-1" class="anchor">§</a><h4 class="code-header">fn <a href="#method.before_instruction" class="fn">before_instruction</a>&lt;OP: <a class="trait" href="trait.OpcodeType.html" title="trait zksync_vm2_interface::OpcodeType">OpcodeType</a>, S: <a class="trait" href="trait.GlobalStateInterface.html" title="trait zksync_vm2_interface::GlobalStateInterface">GlobalStateInterface</a>&gt;(
    &amp;mut self,
    state: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut S</a>,
)</h4></section><section id="method.after_instruction-1" class="method trait-impl"><a class="src rightside" href="../src/zksync_vm2_interface/tracer_interface.rs.html#342-349">source</a><a href="#method.after_instruction-1" class="anchor">§</a><h4 class="code-header">fn <a href="#method.after_instruction" class="fn">after_instruction</a>&lt;OP: <a class="trait" href="trait.OpcodeType.html" title="trait zksync_vm2_interface::OpcodeType">OpcodeType</a>, S: <a class="trait" href="trait.GlobalStateInterface.html" title="trait zksync_vm2_interface::GlobalStateInterface">GlobalStateInterface</a>&gt;(
    &amp;mut self,
    state: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.reference.html">&amp;mut S</a>,
) -&gt; <a class="enum" href="enum.ShouldStop.html" title="enum zksync_vm2_interface::ShouldStop">ShouldStop</a></h4></section><section id="method.on_extra_prover_cycles-1" class="method trait-impl"><a class="src rightside" href="../src/zksync_vm2_interface/tracer_interface.rs.html#351-354">source</a><a href="#method.on_extra_prover_cycles-1" class="anchor">§</a><h4 class="code-header">fn <a href="#method.on_extra_prover_cycles" class="fn">on_extra_prover_cycles</a>(&amp;mut self, stats: <a class="enum" href="enum.CycleStats.html" title="enum zksync_vm2_interface::CycleStats">CycleStats</a>)</h4></section></div></details><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../trait.impl/zksync_vm2_interface/tracer_interface/trait.Tracer.js" data-ignore-extern-crates="std" async></script></section></div></main></body></html>